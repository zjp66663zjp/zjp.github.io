{"posts":[{"title":"虚拟主机与web架构","content":"一.构建基于不同IP的虚拟主机 用户授权优先级低于客户机地址限制 在被允许的主机访问服务器的时候，用户授权不生效 编辑网卡 IP:192.168.1.1 复制ens33 到 虚拟网卡ens33：0 cd /etc/sysconfig/network-scripts/ cp ifcfg-ens33 ifcfg-ens33:0 vim ifcfg-ens33:0 进去后改网卡名字ens33：0 和IP 192.168.1.2 接着安装好apache 编辑 vim /usr/local/httpd/conf/httpd.conf //编辑服务 200G 改 ServerName 192.168.1.1:80 //多域名写IP地址 末行模式输入 /vhosts //查找vhosts 取消注释，开启虚拟主机 vhost支持 ：wq 创建虚拟主机的页面根目录 mkdir -p /myweb/baidu mkdir -p /myweb/sohu 给虚拟主机创建首页文件（创建站点） echo &quot;www.baidu.com&quot; &gt;&gt; /myweb/baidu/index.html echo &quot;www.sohu.com&quot; &gt;&gt; /myweb/sohu/index.html chmod -R 777 /myweb/baidu/ chmod -R 777 /myweb/sohu/ 编辑虚拟主机配置文件 vim /usr/local/httpd/conf/extra/httpd-vhosts.conf 进去后： &lt;Directory &quot;/myweb&quot;&gt; #发布虚拟主机根目录 require all granted &lt;VirtualHost 192.168.1.1:80&gt; DocumentRoot &quot;/myweb/baidu&quot; ServerName www.baidu.com ErrorLog &quot;logs/baidu.com-error_log&quot; CustomLog &quot;logs/baidu.com-access_log&quot; common &lt;VirtualHost 192.168.1.2:80&gt; DocumentRoot &quot;/myweb/sohu&quot; ServerName www.sohu.com ErrorLog &quot;logs/sohu.com-error_log&quot; CustomLog &quot;logs/sohu.com-access_log&quot; common :wq systemctl restart httpd 二.构建相同IP，不同端口号的虚拟主机 [root@localhost /]# vim /usr/local/httpd/conf/httpd.conf 添加： listen 2000 listen 3000 1.配置httpd-vhosts.conf文件，修改虚拟主机选项 [root@localhost /]# vim /usr/local/httpd/conf/extra/httpd-vhosts.conf 修改： &lt;VirtualHost 192.168.1.1:2000&gt; DocumentRoot &quot;/myweb/baidu&quot; ServerName www.baidu.com ErrorLog &quot;logs/baidu.com-error_log&quot; CustomLog &quot;logs/baidu.com-access_log&quot; common &lt;VirtualHost 192.168.1.1:3000&gt; DocumentRoot &quot;/myweb/sohu&quot; ServerName www.sohu.com ErrorLog &quot;logs/sohu.com-error_log&quot; CustomLog &quot;logs/sohu.com-access_log&quot; common [root@localhost named]# systemctl restart httpd 三、构建相同IP，相同端口号，不同主机头的虚拟主机 [root@localhost ~]# mount /dev/cdrom /media/ mount: /dev/sr0 写保护，将以只读方式挂载 [root@localhost ~]# cd /media/Packages/ [root@localhost Packages]# rpm -ivh bind-9.9.4-37.el7.x86_64.rpm 警告：bind-9.9.4-37.el7.x86_64.rpm: 头V3 RSA/SHA256 Signature, 密钥 ID f4a80eb5: NOKEY 准备中... ################################# [100%] 正在升级/安装... 1:bind-32:9.9.4-37.el7 ################################# [100%] [root@localhost Packages]# cd [root@localhost ~]# vim /etc/named.conf options { listen-on port 53 { 192.168.1.1; }; listen-on-v6 port 53 { ::1; }; directory &quot;/var/named&quot;; dump-file &quot;/var/named/data/cache_dump.db&quot;; statistics-file &quot;/var/named/data/named_stats.txt&quot;; memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;; allow-query { any; }; [root@localhost ~]# vim /etc/named.rfc1912.zones zone &quot;baidu.com&quot; IN { type master; file &quot;baidu.com.zone&quot;; allow-update { none; }; }; zone &quot;sohu.com&quot; IN { type master; file &quot;sohu.com.zone&quot;; allow-update { none; }; }; [root@localhost ~]# cd /var/named/ [root@localhost named]# cp -p named.localhost baidu.com.zone [root@localhost named]# cp -p named.localhost sohu.com.zone [root@localhost named]# vim baidu.com.zone TTL 1D @ IN SOA root. www.baidu.com. ( 0 ; serial 1D ; refresh 1H ; retry 1W ; expire 3H ) ; minimum NS www.baidu.com. www IN A 192.168.1.1 AAAA ::1 [root@localhost named]# vim sohu.com.zone TTL 1D @ IN SOA root. www.sohu.com. ( 0 ; serial 1D ; refresh 1H ; retry 1W ; expire 3H ) ; minimum NS www.sohu.com. www IN A 192.168.1.1 AAAA ::1 [root@localhost named]# systemctl restart named 配置httpd-vhosts.conf文件，修改虚拟主机选项 [root@localhost /]# vim /usr/local/httpd/conf/extra/httpd-vhosts.conf 修改： &lt;VirtualHost 192.168.1.1:80&gt; DocumentRoot &quot;/myweb/guiguedu&quot; ServerName www.guiguedu.cn ErrorLog &quot;logs/guiguedu.cn-error_log&quot; CustomLog &quot;logs/guiguedu.cn-access_log&quot; common &lt;VirtualHost 192.168.1.1:80&gt; DocumentRoot &quot;/myweb/baidu&quot; ServerName www.baidu.com ErrorLog &quot;logs/baidu.com-error_log&quot; CustomLog &quot;logs/baidu.com-access_log&quot; common [root@localhost named]# systemctl restart httpd ","link":"https://www.zjp666.cf/post/xu-ni-zhu-ji-yu-web-jia-gou/"},{"title":"说说","content":"暂无 ","link":"https://www.zjp666.cf/post/shuo-shuo/"},{"title":"centos7 DNS主从复制","content":"📝📝📝📝📝📝📝 第一台关防火墙 沙盒 [root@localhost ~]# setenforce 0 [root@localhost ~]# [root@localhost ~]# systemctl stop firewalld [root@localhost ~]# vim /etc/sysconfig/network-scripts/ifcfg-ens33 TYPE=Ethernet BOOTPROTO=static DEFROUTE=yes PEERDNS=yes PEERROUTES=yes IPV4_FAILURE_FATAL=no IPV6INIT=yes IPV6_AUTOCONF=yes IPV6_DEFROUTE=yes IPV6_PEERDNS=yes IPV6_PEERROUTES=yes IPV6_FAILURE_FATAL=no IPV6_ADDR_GEN_MODE=stable-privacy NAME=ens33 #UUID=a143ab4f-711f-4c6e-aab0-4289fbda9db6 DEVICE=ens33 ONBOOT=yes IPADDR=192.168.1.1 NETMASK=255.255.255.0 GATEWAY=192.168.1.100 DNS1=192.168.1.1 [root@localhost ~]# systemctl restart network [root@localhost ~]# ifconfig ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500 inet 192.168.1.1 netmask 255.255.255.0 broadcast 192.168.1.255 [root@localhost ~]# mount /dev/cdrom /media/ [root@localhost ~]# cd /media/Packages/ [root@localhost Packages]# rpm -ivh bind-9.9.4-37.el7.x86_64.rpm [root@localhost Packages]# vim /etc/named.conf 编辑 options { listen-on port 53 { 192.168.1.1; }; listen-on-v6 port 53 { ::1; }; directory &quot;/var/named&quot;; dump-file &quot;/var/named/data/cache_dump.db&quot;; statistics-file &quot;/var/named/data/named_stats.txt&quot;; memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;; allow-query { any; }; [root@localhost Packages]# vim /etc/named.rfc1912.zones 在 zone上面的那一行输入6yy复制6行 在末行输入p粘贴复制的6行 把复制的6行修改成 zone &quot;baidu.com&quot; IN { type master; file &quot;baidu.com.zone&quot;; allow-update { any; };允许下载从服务器ip }; 在 zone上面的那一行输入6yy复制6行 在末行输入p粘贴复制的6行 把复制的6行修改成 zone &quot;1.168.192.in-addr.arpa&quot; IN { type master; file &quot;192.168.1.arpa&quot;; allow-update { any; };允许下载从服务器ip }; [root@localhost Packages]# cd /var/named [root@localhost named]# cp -p named.localhost baidu.com.zone（正向） [root@localhost named]# cp -p named.localhost 192.168.1.arpa（反向） [root@localhost named]# vim baidu.com.zone（正向） [root@localhost named]# vim 192.168.1.arpa（反向） [root@localhost named]# systemctl restart named （重启） 第二台centos7（从服务器）（关防火墙沙河 [root@localhost ~]# setenforce 0 [root@localhost ~]# systemctl stop firewalld [root@localhost ~]# vim /etc/sysconfig/network-scripts/ifcfg-ens33 TYPE=Ethernet BOOTPROTO=static DEFROUTE=yes PEERDNS=yes PEERROUTES=yes IPV4_FAILURE_FATAL=no IPV6INIT=yes IPV6_AUTOCONF=yes IPV6_DEFROUTE=yes IPV6_PEERDNS=yes IPV6_PEERROUTES=yes IPV6_FAILURE_FATAL=no IPV6_ADDR_GEN_MODE=stable-privacy NAME=ens33 #UUID=a143ab4f-711f-4c6e-aab0-4289fbda9db6 DEVICE=ens33 ONBOOT=yes IPADDR=192.168.1.2 NETMASK=255.255.255.0 DNS1=192.168.1.1 [root@localhost ~]# systemctl restart network [root@localhost ~]# ifconfig ens33: flags=4099&lt;UP,BROADCAST,MULTICAST&gt; mtu 1500 inet 192.168.1.10 netmask 255.255.255.0 broadcast 192.168.1.255 [root@localhost ~]# mount /dev/cdrom /media/ [root@localhost ~]# cd /media/Packages/ [root@localhost Packages]# rpm -ivh bind-9.9.4-37.el7.x86_64.rpm [root@localhost Packages]# vim /etc/named.conf 编辑 options { listen-on port 53 { 192.168.1.10; }; listen-on-v6 port 53 { ::1; }; directory &quot;/var/named&quot;; dump-file &quot;/var/named/data/cache_dump.db&quot;; statistics-file &quot;/var/named/data/named_stats.txt&quot;; memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;; allow-query { any; }; [root@localhost Packages]# vim /etc/named.rfc1912.zones 编辑 在 zone上面的那一行输入6yy复制6行 在末行输入p粘贴复制的6行 把复制的6行修改成 zone &quot;baidu.com&quot; IN { type slave;类型改为从配置文件 masters {192.168.1.1;};指定主服务器 file &quot;slaves/baidu.com.zone&quot;; allow-update { none; }; }; 在 zone上面的那一行输入6yy复制6行 在末行输入p粘贴复制的6行 把复制的6行修改成 zone &quot;1.168.192.in-addr.arpa&quot; IN { type slave;类型改为从配置文件 masters {192.168.1.1;};指定主服务器 file &quot;slaves/192.168.1.arpa&quot;; allow-update { none; }; }; [root@localhost Packages]# service named start [root@localhost Packages]# cd /var/named/slaves/ [root@localhost slaves]# ls 1.168.192.arpa baidu.com.zone Centos访问（两台都能访问） nslookup 192.168.1.1 Nslookup www.baidu.com Nslookup 192.168.1.2 Ns lookup www.baidu.com Win7（客户端） ","link":"https://www.zjp666.cf/post/centos7-dns-zhu-cong-fu-zhi/"},{"title":"apache服务的搭建及优化","content":"一、准备环境 📜📜📜📜📜📜📜 1、关闭防火墙： [root@localhost ~]# systemctl stop firewalld.service 2、关闭SELinux： [root@localhost ~]# vim /etc/selinux/config 修改： SELINUX=disabled [root@localhost ~]# setenforce 0 3、卸载默认安装的apache： [root@localhost ~]# rpm -e httpd --nodeps 4、安装依赖关系： [root@localhost ~]# mount /dev/sr0 /media [root@localhost ~]# cd /media/Packages [root@localhost Packages]# rpm -ivh apr-1.4.8-3.el7.x86_64.rpm [root@localhost Packages]# rpm -ivh apr-devel-1.4.8-3.el7.x86_64.rpm [root@localhost Packages]# rpm -ivh cyrus-sasl-devel-2.1.26-19.2.el7.x86_64.rpm [root@localhost Packages]# rpm -ivh expat-devel-2.1.0-8.el7.x86_64.rpm [root@localhost Packages]# rpm -ivh libdb-devel-5.3.21-19.el7.x86_64.rpm [root@localhost Packages]# rpm -ivh openldap-devel-2.4.40-8.el7.x86_64.rpm [root@localhost Packages]# rpm -ivh apr-util-1.5.2-6.el7.x86_64.rpm [root@localhost Packages]# rpm -ivh apr-util-devel-1.5.2-6.el7.x86_64.rpm [root@localhost Packages]# rpm -ivh pcre-devel-8.32-15.el7.x86_64.rpm [root@localhost Packages]# rpm -ivh pcre-8.32-15.el7.x86_64.rpm 利用yum库安装： yum -y install apr-1.4.8-3.el7.x86_64.rpm apr-devel-1.4.8-3.el7.x86_64.rpm cyrus-sasl-devel-2.1.26-20.el7_2.x86_64.rpm expat-devel-2.1.0-8.el7.x86_64.rpm libdb-devel-5.3.21-19.el7.x86_64.rpm openldap-devel-2.4.40-13.el7.x86_64.rpm apr-util-1.5.2-6.el7.x86_64.rpm apr-util-devel-1.5.2-6.el7.x86_64.rpm pcre-devel-8.32-15.el7_2.1.x86_64.rpm pcre-8.32-15.el7_2.1.x86_64.rpm 5、配置IP地址： [root@localhost httpd-2.4.25]# vim /etc/sysconfig/network-scripts/ifcfg-ens33 修改： BOOTPROTO=static ONBOOT=yes 添加： IPADDR=192.168.10.1 NETMASK=255.255.255.0 [root@localhost httpd-2.4.25]# systemctl restart network [root@localhost httpd-2.4.25]# ip addr 二、编译安装httpd 1、更换工具盘： [root@localhost ~]# mount /dev/sr0 /media [root@localhost ~]# cd /media [root@localhost media]# ll 2、解压软件： [root@localhost media]# tar -zxvf httpd-2.4.25.tar.gz -C /usr/src [root@localhost media]# cd /usr/src/httpd-2.4.25 3、配置 [root@localhost httpd-2.4.25]# ./configure --prefix=/usr/local/httpd --enable-so --enable-rewrite --enable-charset-lite --enable-cgi --enable-sockets 注意：默认安装的系统没有gcc与gcc-c++组件，无法配置编译开源软件，以下为安装gcc组件的方法。 挂载系统光盘到/media目录： umount /dev/sr0 mount /dev/sr0 /media 编辑yum配置文件： cd /etc/yum.repos.d rm -f * vim yum.repo 添加内容： [yum] baseurl=file:///media enabled=1 gpgcheck=0 保存退出 转入光盘目录： cd /media/Packages yum -y install gcc gcc-c++ 4、编译及安装： cd /usr/src/httpd-2.4.25/ [root@localhost httpd-2.4.25]# make &amp;&amp; make install 5、优化路径与服务： [root@localhost httpd-2.4.25]# ln -s /usr/local/httpd/bin/* /usr/local/bin [root@localhost httpd-2.4.25]# cp /usr/local/httpd/bin/apachectl /etc/init.d/httpd [root@localhost httpd-2.4.25]# chmod a+x /etc/init.d/httpd [root@localhost httpd-2.4.25]# vim /etc/init.d/httpd 添加： #chkconfig:35 85 21 #description:apache http server 6、添加httpd为系统服务： [root@localhost httpd-2.4.25]# chkconfig --add httpd [root@localhost httpd-2.4.25]# chkconfig --list 7、建立 .service配置文件 [root@localhost httpd-2.4.25]# vim /lib/systemd/system/httpd.service 添加： [Unit] Description=apache http server after=network.target [Service] Type=forking PIDFile=/usr/local/httpd/logs/httpd.pid ExecStart=/usr/local/bin/apachectl $OPTION ExecReload=/bin/kill -HUP $MAINPID killMode=process Restart=on-failure RestartSec=42s [Install] WantedBy=graphical.target 8、设置开机自动启动： [root@localhost httpd-2.4.25]# systemctl enable httpd.service [root@localhost httpd-2.4.25]# systemctl is-enabled httpd.service 9、启动服务： [root@localhost httpd-2.4.25]# systemctl start httpd 10、页面测试： [root@localhost httpd-2.4.25]# firefox http://192.168.10.1 &amp; 11、查看访问日志： [root@localhost /]# tail /usr/local/httpd/logs/access_log 或者 [root@localhost /]# cat /usr/local/httpd/logs/access_log 12、查看错误日志： [root@localhost /]# tail /usr/local/httpd/logs/error_log 或者 [root@localhost /]# cat /usr/local/httpd/logs/error_log 13、修改配置文件： [root@localhost /]# vim /usr/local/httpd/conf/httpd.conf 14、检查配置文件语法： [root@localhost /]# /usr/local/httpd/bin/httpd -t 或者 [root@localhost /]# /usr/local/httpd/bin/apachectl -t 15、压力测试： ab -n 1000 -c 100 http://192.168.10.1/index.html ab -n 1000 -c 10 http://192.168.10.1/index.html ","link":"https://www.zjp666.cf/post/apache-fu-wu-de-da-jian-ji-you-hua/"},{"title":"精选鬼刀壁纸","content":" ","link":"https://www.zjp666.cf/post/jing-xuan-gui-dao-bi-zhi/"},{"title":"源码包安装详解","content":"#源码包安装方法：此处以httpd服务为例 [root@localhost ~]#setenforce 0 #临时关闭沙盒 [root@localhost ~]# systemctl stop firewall Failed to stop firewall.service: Unit firewall.service not loaded. #关闭防火墙 [root@localhost ~]# vim /etc/sysconfig/network-scripts/ifcfg-ens33 #配置ip地址 [root@localhost ~]# systemctl restart network #重启网络服务 [root@localhost ~]# ifconfig #查看IP地址是否更改 以上为必备条件 [root@localhost ~]# tar -zxvf httpd-2.2.17.tar.gz -C /usr/src/ #归档解压软件包并指定路径 #-z：gzip文件 -x：解压 -v：详细信息 -f：归档 -C指定路径 [root@localhost ~]# cd /usr/src/httpd-2.2.17/ #转到刚解压的软件下 [root@localhost httpd-2.2.17]# ./configure --prefix=/usr/local/httpd #配置并指定安装路径 ./configure :默认配置 --prefix=安装路径 [root@localhost httpd-2.2.17]# make &amp;&amp; make install #编译并安装 make：编译 make install：安装编译 [root@localhost httpd-2.2.17]# vim /usr/local/httpd/conf/httpd.conf #编辑主配置文件 把第97行#去掉启用配置{方法：打开大写按97G} [root@localhost httpd-2.2.17]# /usr/local/httpd/bin/apachectl start #开启apachectl 服务 [root@localhost httpd-2.2.17]# vim /usr/local/httpd/htdocs/index.html 默认网页后台路径{更改网页显示信息} by:zjp 2020-11-10 ","link":"https://www.zjp666.cf/post/yuan-ma-bao-an-zhuang-xiang-jie/"}]}